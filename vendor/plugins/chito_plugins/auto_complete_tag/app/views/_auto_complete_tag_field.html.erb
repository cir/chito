<style type="text/css" media="all">
    #article_tag_list{
        width:700px;
    }

</style>
<% 
    @tags = @user.posts.tag_counts.map {|t| t.name}.sort rescue @tags = []
    @article_tags = @article.tag_list.split(',') rescue @article_tags = []

-%>
<label><strong>Tags</strong> <%= t("plugins.auto_complete_tag.comma")  %> :</label>


<%= text_field_tag "article[tag_list]", @article.tag_list, :autocomplete => false, :id => "article_tag_list" %>

<%= plugin_javascript_inculde_tag "auto_complete_tag", "jquery-textext-1.2.0.js" %>

<script type="text/javascript">
    $('#article_tag_list')
        .textext({
            plugins : 'tags autocomplete arrow',
            tagsItems: $('#article_tag_list').val().split(',')

        })
        .bind('getSuggestions', function(e, data)
        {
            var list = [
                    <% for tag in @tags -%>
                        '<%= tag %>',
                    <% end -%>
                ],
                textext = $(e.target).textext()[0],
                query = (data ? data.query : '') || ''
                ;

            $(this).trigger(
                'setSuggestions',
                { result : textext.itemManager().filter(list, query) }
            );
        })
        ;
    $('#article_tag_list').val('');
</script>

