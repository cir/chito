<div id="file_list_top">
<div id="space_info"><%=t(:used, :scope => [:txt, :view, :admin, :files]) %> <%= @precent.round(1) %>% | <%= @used_space.round(1) %>M/<%= @user.get_group.space %>M</div><style>#used_space{width:<%= @precent.round(1) %>%;}</style>
<div id="space_bar"><div id="used_space"></div></div>
<div id="folder_info">
<span class="file_info_type">
<% if @type == 'File'-%>
    <%=t(:file, :scope => [:txt, :view, :admin, :files])  %>
<% elsif @type == 'Image' -%>
    <%=t(:image, :scope => [:txt, :view, :admin, :files])  %>
<% elsif @type == 'Flash' -%>
    <%=t(:flash, :scope => [:txt, :view, :admin, :files]) %>
<% end -%>
</span>
<span class="file_info_folder"><%= @folder %></span>
<span id='in_pro' style='margin-left:20px;color:#06f;display:none;'><%=t(:loading, :scope => [:txt, :view, :admin, :files])  %> <img src='/images/inprogress.gif' /></span>
<span id='delete_flash'><%= flash[:notice] %></span>
</div>
</div>
<table id="file_table" class="sofT" cellspacing="0">
    <% unless @folder.blank? or @folder =~ /^\/$/-%>
    <tr>
	    <td class="file_pic_col"><%= link_to_files (image_tag 'up-folder.png'), :type => @type, :folder => File.dirname(@folder) %></td>
	    <td class="file_name_col"><%= link_to_files t(:up, :scope => [:txt, :view, :admin, :files]), :type => @type, :folder => File.dirname(@folder)  %></td>
	    <td class="file_size_col"></td>
	    <td class="file_action_col"></td>
    </tr>
    <% end -%>
    <% for folder in @folders -%>
    <tr class="<%= cycle "odd", "" %>">
	    <td class="file_pic_col"><%= image_tag 'folder.png' %></td>
	    <td class="file_name_col"><%= link_to_files folder, :type => @type, :folder => File.join(@folder, folder) %></td>
	    <td class="file_size_col"></td>
	    <td class="file_action_col delete"><%= link_to t(:delete, :scope => [:txt, :view, :admin, :files]), {:action => 'delete_dir', :type => @type, :folder => @folder, :name => folder} , :remote => true, :method => :delete, :onclick => "$('#in_pro').show();", :confirm => t(:delete_folder?, :scope => [:txt, :view, :admin, :files], :folder => folder), :class => "delete" %></td>
    </tr>
    <% end -%>
    <% for file in @files -%>
    <tr class="<%= cycle "odd", "" %>">
	    <td class="file_pic_col">
	    <% if file[:thumbnail] -%>
		<%= image_tag file[:thumbnail], :alt => file[:name], :class => "image_entry", :title => file[:url] %>
	    <% else -%>
		<%= image_tag 'file.png', :class => "file_entry" %>
	    <% end -%>
	    </td>
	    <td class="file_name_col">
	    <%= link_to file[:name], file[:url], :target => '_blank', :title => t(:download, :scope => [:txt, :view, :admin, :files]) %>
	    </td>
	    <td class="file_size_col"><%= file[:size] %>KB</td>
	    <td class="file_action_col delete"><%= link_to t(:delete, :scope => [:txt, :view, :admin, :files]), {:action => 'delete_file', :name => file[:name], :type => @type, :folder => @folder}, :remote => true, :method => :delete, :onclick => "$('#in_pro').show();", :confirm => t(:delete_file?, :scope => [:txt, :view, :admin, :files], :file => file[:name]), :class => "delete"  %></td>
    </tr>
    <% end -%>	
</table>

<% if params[:editor] -%>
    <script type="text/javascript">
    //<![CDATA[
        $(".image_entry").each(function(){
            $(this).click(function(){
                var url = $(this).attr('title'); 
                CKEDITOR.tools.callFunction(CKEditorFuncNum, url);
                window.close();
            });
        });
    //]]>
    </script>
<% end -%>
